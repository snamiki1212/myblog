---
import { getCollection } from "astro:content";
import PostCardListLayout from "../../layouts/PostCardListLayout.astro";
import { toTagEntry, sortByCreatedAt } from "../../utils/meta";

import { type BlogEntry } from "../../utils/astro.ts";

interface Props {
  entries: BlogEntry[];
  total: number;
  meta: string;
}

export async function getStaticPaths() {
  const blogEntries = sortByCreatedAt(await getCollection("blog"));
  const list = toTagEntry(blogEntries);
  return list.map(([tag, entries]) => {
    const params = { slug: tag };
    const props = { entries, total: entries.length, meta: tag } satisfies Props;
    return { params, props };
  });
}

const { entries, total, meta } = Astro.props;
---

<PostCardListLayout meta={meta} entries={entries} total={total} />
