---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/PostListLayout.astro";
import { toTagEntry, sortByCreatedAt } from "../../utils/meta";

type BlogEntry = CollectionEntry<"blog">;

interface Props {
  entries: BlogEntry[];
  total: number;
  meta: string;
}

const metaType = "tag" as const;

export async function getStaticPaths() {
  const blogEntries = sortByCreatedAt(await getCollection("blog"));
  const list = toTagEntry(blogEntries);
  return list.map(([tag, entries]) => {
    const params = { slug: tag };
    const props = { entries, total: entries.length, meta: tag } satisfies Props;
    return { params, props };
  });
}

const { entries, total, meta } = Astro.props;
---

<Layout meta={meta} entries={entries} metaType={metaType} total={total} />
