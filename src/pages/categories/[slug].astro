---
import { getCollection, CollectionEntry } from "astro:content";
import Layout from "../../layouts/PostListLayout.astro";
import { toCategoryEntry, sortByCreatedAt } from "../../utils/meta";

type BlogEntry = CollectionEntry<"blog">;

interface Props {
  entries: BlogEntry[];
}

export async function getStaticPaths() {
  const blogEntries = sortByCreatedAt(await getCollection("blog"));
  return toCategoryEntry(blogEntries).map(([category, entries]) => {
    const props = { entries } satisfies Props;
    return { params: { slug: category }, props };
  });
}

const { entries } = Astro.props;
const { slug: meta = "" } = Astro.params;
const metaType = "category" as const;
---

<Layout meta={meta} entries={entries} metaType={metaType} />
