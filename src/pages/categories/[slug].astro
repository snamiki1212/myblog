---
import { getCollection, type CollectionEntry } from "astro:content";
import Layout from "../../layouts/PostListLayout.astro";
import { toCategoryEntryList, sortByCreatedAt } from "../../utils/meta";

type BlogEntry = CollectionEntry<"blog">;

interface Props {
  entries: BlogEntry[];
  total: number;
  meta: string;
}

const metaType = "category" as const;

export async function getStaticPaths() {
  const blogEntries = sortByCreatedAt(await getCollection("blog"));
  const list = toCategoryEntryList(blogEntries);
  return list.map(([category, entries]) => {
    const params = { slug: category };
    const props = {
      entries,
      total: entries.length,
      meta: category,
    } satisfies Props;
    return { params, props };
  });
}

const { entries, total, meta } = Astro.props;
---

<Layout meta={meta} entries={entries} metaType={metaType} total={total} />
